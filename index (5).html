<!DOCTYPE html><html lang="sv"><head><meta charset="utf-8"><title>Fredagsdrinken</title></head>
<body>
<input id="servings" /><button id="btnRandom"></button>
<script>
function init(){
  $("#btnAlcohol")?.addEventListener("click",()=>setType && setType("alcohol"));
  $("#btnNoAlcohol")?.addEventListener("click",()=>setType && setType("noalcohol"));
  const s = document.querySelector("#servings");

  // Prevent unwanted characters but ALLOW delete/backspace; do not force a value
  s.addEventListener("keydown", e => {
    if (["e","E","+","-",".",","].includes(e.key)) e.preventDefault();
  });
  // Avoid accidental scroll changing the value
  s.addEventListener("wheel", e => e.preventDefault(), {passive:false});

  // While typing: accept empty and partial digits, don't auto-correct to 1
  s.addEventListener("input", e => {
    const raw = e.target.value.replace(/\D+/g,'');
    if (raw === "") { state.servings = null; return; }
    let v = parseInt(raw, 10);
    if (Number.isNaN(v)) { state.servings = null; return; }
    // don't clamp here; user may still type. Just store current number.
    state.servings = v;
    if(state.currentId && typeof getById === "function" && typeof renderRecipe === "function") renderRecipe(getById(state.currentId));
  });

  // On leaving the field: clamp to 1â€“12 and reflect in UI
  s.addEventListener("blur", () => {
    let raw = s.value.replace(/\D+/g,'');
    let v = parseInt(raw || "1", 10);
    if (!v || v < 1) v = 1;
    if (v > 12) v = 12;
    s.value = String(v);
    state.servings = v;
    if(state.currentId && typeof getById === "function" && typeof renderRecipe === "function") renderRecipe(getById(state.currentId));
  });

  // When clicking randomize, ensure a valid value and clamp
  function ensureServings(){
    let raw = s.value.replace(/\D+/g,'');
    let v = parseInt(raw || "1", 10);
    if (!v || v < 1) v = 1;
    if (v > 12) v = 12;
    s.value = String(v);
    state.servings = v;
  }

  document.querySelector("#btnRandom").addEventListener("click", () => { ensureServings(); randomize && randomize(); });
  if (typeof renderFavorites === "function") renderFavorites();
}

document.addEventListener("DOMContentLoaded", init);
</script>
</body></html>